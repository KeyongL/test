# 🚀 问卷模板一键部署指南

> **文档版本**：v2.0  
> **最后更新**：2024年1月18日  
> **适用场景**：可复用问卷系统模板，支持快速配置和部署  
> **目标**：3-5分钟完成新问卷部署

---

## ⚡ 快速开始：一键部署检查清单

### ✅ 首次使用（只需一次）

- [ ] 代码已在 GitHub 仓库
- [ ] 已在 Streamlit Cloud 连接过仓库（访问 https://share.streamlit.io/）

**如果以上都完成 → 直接跳到"快速复用"部分**

---

## 🎯 场景 1：快速复用（3分钟一键部署）

**适用**：已有部署环境，只需要修改问卷内容

### 步骤 1：修改配置文件（2分钟）

打开 `survey_config.json`，修改以下内容：

```json
{
    "app_config": {
        "title": "你的问卷标题",           // ← 修改这里
        "icon": "📚",                      // ← 可选：修改图标
        "password": "你的后台密码"         // ← 修改密码
    },
    "questions": [
        // ← 在这里添加或修改你的问题
        {
            "id": "question1",             // ← 英文ID，不能重复
            "text": "1. 你的第一个问题？", // ← 问题文本
            "type": "single",              // ← "single"单选 或 "multi"多选
            "options": ["选项A", "选项B"]  // ← 选项数组
        }
    ]
}
```

**配置模板**：
- **单选题**：`"type": "single"`
- **多选题**：`"type": "multi"`
- **支持"其它"**：在选项数组中添加 `"其它：______"`

### 步骤 2：一键部署（1分钟）

复制粘贴以下命令：

```bash
git add survey_config.json && git commit -m "Update survey" && git push origin main
```

或者分步执行：

```bash
git add survey_config.json
git commit -m "Update survey"
git push origin main
```

**等待 1-2 分钟**，Streamlit Cloud 自动部署完成！

---

## 🆕 场景 2：首次部署（10分钟）

**适用**：第一次使用这个模板

### 前置条件检查

- [ ] Python 3.7+ 已安装
- [ ] Git 已安装
- [ ] GitHub 账号已注册
- [ ] Streamlit Cloud 账号（用 GitHub 登录即可）

### 步骤 1：准备代码（5分钟）

#### 1.1 克隆或下载代码到本地

```bash
git clone https://github.com/KeyongL/test.git
cd test
```

或者如果你已经有这个项目：

```bash
cd survay_robat  # 你的项目目录
```

#### 1.2 安装依赖

```bash
pip install -r requirements.txt
```

#### 1.3 修改配置文件

按照"场景1"的步骤1修改 `survey_config.json`

#### 1.4 本地测试（可选）

```bash
streamlit run app.py
```

访问 `http://localhost:8501` 测试

### 步骤 2：推送到 GitHub（2分钟）

```bash
git add .
git commit -m "Initial survey setup"
git push origin main
```

### 步骤 3：部署到 Streamlit Cloud（3分钟）

1. 访问：https://share.streamlit.io/
2. 用 GitHub 账号登录
3. 点击右上角 **"New app"**
4. 填写信息：
   - **Repository**: 选择你的仓库（如 `KeyongL/test`）
   - **Branch**: `main`
   - **Main file path**: `app.py`
5. 点击 **"Deploy"**
6. 等待 1-2 分钟，获得部署链接

**完成！** 之后每次只需按"场景1"操作即可。

---

## 📝 配置文件详细说明

### 完整配置示例

```json
{
    "app_config": {
        "title": "用户满意度调研",
        "icon": "⭐",
        "password": "survey2024"
    },
    "questions": [
        {
            "id": "satisfaction",
            "text": "1. 您对产品的整体满意度？",
            "type": "single",
            "options": [
                "非常满意",
                "满意",
                "一般",
                "不满意",
                "非常不满意"
            ]
        },
        {
            "id": "features",
            "text": "2. 您最喜欢哪些功能？（可多选）",
            "type": "multi",
            "options": [
                "界面设计",
                "功能丰富",
                "性能稳定",
                "客服支持",
                "其它：______"
            ]
        },
        {
            "id": "suggestions",
            "text": "3. 您有什么改进建议？",
            "type": "single",
            "options": [
                "暂无",
                "其它：______"
            ]
        }
    ]
}
```

### 配置字段说明

| 字段 | 说明 | 示例 |
|------|------|------|
| `app_config.title` | 问卷标题（显示在网页上） | `"用户满意度调研"` |
| `app_config.icon` | 页面图标（emoji） | `"⭐"` |
| `app_config.password` | 后台查看密码 | `"survey2024"` |
| `questions[].id` | 问题唯一标识（英文） | `"satisfaction"` |
| `questions[].text` | 问题文本 | `"1. 您对产品满意度？"` |
| `questions[].type` | 问题类型 | `"single"` 或 `"multi"` |
| `questions[].options` | 选项数组 | `["选项1", "选项2"]` |

### 特殊功能

**支持"其它"选项**：
- 在选项数组中添加 `"其它：______"`
- 选择后会自动显示文本输入框
- 填写的内容会自动保存到数据库

---

## 🔄 完整工作流程

### 新问卷部署流程

```
1. 准备问卷内容（问题+选项）
   ↓
2. 修改 survey_config.json（填入内容）
   ↓
3. 运行：git add && commit && push
   ↓
4. 等待 1-2 分钟自动部署
   ↓
5. 访问 Streamlit Cloud 链接
   ↓
6. 开始收集数据！
```

### 数据收集与分析流程

```
1. 用户填写问卷
   ↓
2. 数据自动保存到数据库
   ↓
3. 查看数据（实时统计、导出、删除）
   ↓
4. 生成数据分析报告（按需）
   ↓
5. 导出报告文件
```

---

## 📊 功能清单

✅ **问卷功能**
- 支持单选题和多选题
- 支持"其它"文本输入
- 分页式填写体验
- 数据自动验证

✅ **数据管理**
- 自动保存到数据库
- 实时统计图表
- 数据导出 CSV
- 删除无效数据
- 密码保护后台

✅ **数据分析**
- 自动分类汇总（教学/论文/课题）
- 可视化图表展示
- 完整分析报告生成
- 报告文件下载

✅ **部署运维**
- 一键部署上线
- 自动更新部署
- 无需服务器配置
- 免费托管（Streamlit Cloud）

---

## ❓ 常见问题（FAQ）

### Q1: 如何快速判断是否已部署过？

**检查方法**：
- 访问 https://share.streamlit.io/
- 登录后查看是否有已部署的应用
- 如果有 → 使用"场景1：快速复用"
- 如果没有 → 使用"场景2：首次部署"

### Q2: 修改配置文件后多久生效？

**推送代码后**：
- Streamlit Cloud 自动检测更新
- 通常 1-2 分钟内自动重新部署
- 刷新网页即可看到新问卷

### Q3: 如何查看收集的数据？

1. 打开部署的问卷网站
2. 左侧选择 "📊 查看数据"
3. 输入密码（`app_config.password` 中设置的）
4. 查看统计、导出 CSV、删除数据

### Q4: 如何生成数据分析报告？

1. 左侧选择 "📈 数据分析报告"
2. 输入密码
3. **自动生成**完整分析报告（手动触发，自动生成）
4. 查看报告内容和图表
5. 下载报告文件

**触发方式**：手动点击页面 → 自动生成报告（基于最新数据）

### Q5: 如何删除无效数据？

1. 进入"查看数据"页面
2. 点击 "🗑️ 删除模式"
3. 勾选要删除的记录
4. 点击 "⚠️ 确认删除选中记录"

### Q6: 数据库在哪里？数据会丢失吗？

- **本地**：项目目录下的 `survey_data.db`
- **线上**：Streamlit Cloud 的临时存储
- **建议**：定期从后台导出 CSV 文件备份

### Q7: 可以同时运行多个问卷吗？

**可以！** 有几种方式：
1. **同一仓库不同分支**：创建新分支，修改配置，分别部署
2. **不同仓库**：复制整个项目到新仓库，分别部署
3. **同一应用**：修改配置文件，覆盖旧问卷（数据会分开保存）

---

## 💡 最佳实践

### 问卷设计

1. **问题 ID 命名规范**：
   - 使用英文、小写、下划线
   - 如：`user_age`, `product_satisfaction`
   - 确保每个问题的 ID 唯一

2. **问题顺序**：
   - 先简单后复杂
   - 先必答后可选
   - 同类问题集中

3. **选项设计**：
   - 选项数量适中（单选3-7个，多选5-10个）
   - 选项互斥（单选）或独立（多选）
   - 提供"其它"选项增加灵活性

### 数据管理

1. **定期备份**：
   - 从后台导出 CSV 文件
   - 建议每周或每月备份一次

2. **数据清理**：
   - 及时删除测试数据
   - 删除无效或重复的提交

3. **隐私保护**：
   - 不收集个人身份信息
   - 密码定期更换
   - 敏感数据加密存储

### 部署优化

1. **测试先行**：
   - 本地测试确认无误后再推送
   - 检查所有问题显示正常

2. **版本管理**：
   - 每次修改都用清晰的 commit 信息
   - 重要修改添加标签（tag）

3. **监控使用**：
   - 定期查看数据收集情况
   - 关注用户反馈

---

## 🔄 完整闭环流程说明

### 数据流转过程

```
1. 问卷填写 
   ↓
2. 数据自动保存到数据库
   ↓
3. 查看数据（实时统计、导出、删除）
   ↓
4. 数据分析报告（手动触发，自动生成）
   ↓
5. 导出报告文件
```

### 各功能触发方式总结

| 功能 | 触发方式 | 说明 |
|------|---------|------|
| 问卷填写 | 用户访问网站自动显示 | 自动 |
| 数据保存 | 用户提交问卷后自动保存 | 自动 |
| 数据查看 | 手动点击"查看数据"页面 | 手动触发 |
| 统计分析 | 进入"查看数据"页面自动显示 | 手动触发，自动生成 |
| 数据删除 | 手动开启删除模式后操作 | 手动 |
| **数据分析报告** | **手动点击"数据分析报告"页面** | **手动触发，自动生成** |
| 报告导出 | 手动点击下载按钮 | 手动 |

**关键点**：
- 数据分析报告是**手动触发**（点击页面），但报告内容是**自动生成**（基于最新数据）
- 每次进入报告页面都会重新生成，确保看到最新分析结果
- 不需要频繁查看，建议收集足够数据后再查看（如20份以上）

---

## 📚 快速参考命令

### 一键部署命令（复制即用）

```bash
# 快速复用：修改配置后一键部署
git add survey_config.json && git commit -m "Update survey" && git push origin main

# 本地测试
streamlit run app.py

# 查看 Git 状态
git status

# 查看提交历史
git log --oneline -5
```

### 配置文件位置

- 配置文件：`survey_config.json`
- 主程序：`app.py`
- 依赖文件：`requirements.txt`
- 数据库：`survey_data.db`（本地）

---

## 🎯 快速复用模板

下次需要新问卷时，复制这个模板：

```json
{
    "app_config": {
        "title": "[问卷标题]",
        "icon": "📋",
        "password": "[设置密码]"
    },
    "questions": [
        {
            "id": "q1",
            "text": "1. [问题1]",
            "type": "single",
            "options": ["选项A", "选项B", "选项C"]
        },
        {
            "id": "q2",
            "text": "2. [问题2]（可多选）",
            "type": "multi",
            "options": ["选项1", "选项2", "选项3"]
        }
    ]
}
```

然后：
1. 填入你的问卷内容
2. 运行：`git add survey_config.json && git commit -m "New survey" && git push`
3. 等待 1-2 分钟，完成！

---

**最后更新**：2024年1月18日  
**文档版本**：v2.0（一键部署优化版）
